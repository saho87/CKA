# doku: Kubernetes+-CKA-+0600+-+Security S. 99/100

# user benÃ¶tigt Key -> User
openssl genrsa -out jane.key 2048

# Erstellen eines CertificateSigningRequest (CSR) -> User
openssl req -new -key jane.key -subj "/CN=jane" -out jane.csr

# Erstellen eines CertificateSigningRequest Object -> Kubernetes Admin
cat jane.csr | base 64 -w 0 # in einer Zeile

---
---
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: john-developer
spec:
  signerName: kubernetes.io/kube-apiserver-client
  request: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZEQ0NBVHdDQVFBd0R6RU5NQXNHQTFVRUF3d0VhbTlvYmpDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRApnZ0VQQURDQ0FRb0NnZ0VCQUt2Um1tQ0h2ZjBrTHNldlF3aWVKSzcrVVdRck04ZGtkdzkyYUJTdG1uUVNhMGFPCjV3c3cwbVZyNkNjcEJFRmVreHk5NUVydkgyTHhqQTNiSHVsTVVub2ZkUU9rbjYra1NNY2o3TzdWYlBld2k2OEIKa3JoM2prRFNuZGFvV1NPWXBKOFg1WUZ5c2ZvNUpxby82YU92czFGcEc3bm5SMG1JYWpySTlNVVFEdTVncGw4bgpjakY0TG4vQ3NEb3o3QXNadEgwcVpwc0dXYVpURTBKOWNrQmswZWhiV2tMeDJUK3pEYzlmaDVIMjZsSE4zbHM4CktiSlRuSnY3WDFsNndCeTN5WUFUSXRNclpUR28wZ2c1QS9uREZ4SXdHcXNlMTdLZDRaa1k3RDJIZ3R4UytkMEMKMTNBeHNVdzQyWVZ6ZzhkYXJzVGRMZzcxQ2NaanRxdS9YSmlyQmxVQ0F3RUFBYUFBTUEwR0NTcUdTSWIzRFFFQgpDd1VBQTRJQkFRQ1VKTnNMelBKczB2czlGTTVpUzJ0akMyaVYvdXptcmwxTGNUTStsbXpSODNsS09uL0NoMTZlClNLNHplRlFtbGF0c0hCOGZBU2ZhQnRaOUJ2UnVlMUZnbHk1b2VuTk5LaW9FMnc3TUx1a0oyODBWRWFxUjN2SSsKNzRiNnduNkhYclJsYVhaM25VMTFQVTlsT3RBSGxQeDNYVWpCVk5QaGhlUlBmR3p3TTRselZuQW5mNm96bEtxSgpvT3RORStlZ2FYWDdvc3BvZmdWZWVqc25Yd0RjZ05pSFFTbDgzSkljUCtjOVBHMDJtNyt0NmpJU3VoRllTVjZtCmlqblNucHBKZWhFUGxPMkFNcmJzU0VpaFB1N294Wm9iZDFtdWF4bWtVa0NoSzZLeGV0RjVEdWhRMi80NEMvSDIKOWk1bnpMMlRST3RndGRJZjAveUF5N05COHlOY3FPR0QKLS0tLS1FTkQgQ0VSVElGSUNBVEUgUkVRVUVTVC0tLS0tCg==
  usages:
  - digital signature
  - key encipherment
  - client auth
---

kubectl apply -f jane-csr.yaml


# CSR anzeigen lassen -> Kubernetes Admin
kubectl get csr

# CSR genehmigen -> Kubernetes Admin
kubectl certificate approve jane

# Zertifikat mit User teilen -> Kubernetes Admin --> User
kubectl get csr jane -o yaml
echo "LS0...Qo" | base64 --decode

LS0tLS1CRUdJTiBDRVJUSUZJQ0FURSBSRVFVRVNULS0tLS0KTUlJQ1ZqQ0NBVDRDQVFBd0VURVBNQTBHQTFVRUF3d0dZV3R6YUdGNU1JSUJJakFOQmdrcWhraUc5dzBCQVFFRgpBQU9DQVE4QU1JSUJDZ0tDQVFFQXErLzhic1NZLzhTaHJGS3FkUEtmSUt0eFJWbFNmT3ZsMWhOcERESnBkQmxkCkZwWlRxSG0zeEQ4ajEydUNpRTc0TkppSTZBNWZOeUhLQkNNU090WnpwdWs1M29aUW51RndKQnRpZ3BGWkQwZDYKSUN6dDdkY3U5TlFvZnZqaFdHdHhNRXJDdlU2aXF3RlF0MnFRcU8rTzVXL25vcEZEdjI4NHNrZUtPN3FiZVN5MApoMWd1aUdWOTZJSVlTditXOHVpd0MrQldOdTBTNG9KZEVJRXg4Y3RYWHpJYlZpSXpjbC94eEF2UjY3YitJWjZNCmJ5QVZXNzZub2dSeGJHYmVaMUN3N21kaG94RW9Jdjg4VTNLS09obUZyN3pzK2c1Ny9OdVQvSk0ycGR3cW0yVW0KSEJzaDZpaW1BVlVwWHE2ajlnSFVWM2JoWm56UGRuT0puQjRoUmdXSTFRSURBUUFCb0FBd0RRWUpLb1pJaHZjTgpBUUVMQlFBRGdnRUJBSjEydzREZXh2bUVHb1lXZUtUVlcwMFV2cEJaK21lREZ4N3cvMGJlb0JrbnpOWTZxU2E0Ckdna0ZHZ0VCYnQ1cnFib2VvZzdsV3NSTlNId0thZEQ4akYzcWhrWnNoVDJFWW5GNmxiVXJxa3FWSWIwSjBWT3UKUnowN3dUNlk4eXNjSWJwajhVTTFOaTRVUjFvTG9NNEJEZVBYUXpuQVRPZ3E2ZkpYN1BHenZkYWY2WU9IcldOdApTaWdncmpaVjZPZU9OdWVoWTN3c1ptVjNEMVZjaGtnL0hLem0yYmtvenVIQTR0R0tXVTNHREpJQVpvaEJkeFZVCkhreUIrQXVwNGRCQzZuR3BoMjdoVW9UNXdkOXlCQnN2R1A0WDZ5VlBOU1lTMXdPdDJvTWRuczd1MEtxTUt5elMKSUdpNnZma3QwQXlhN0VISWRyNEN1aWZmc1FoOEFiRjNkOXc9Ci0tLS0tRU5EIENFUlRJRklDQVRFIFJFUVVFU1QtLS0tLQo=